sudo: required
language: node_js
node_js:
  - stable
services:
  - docker
install:
  - docker build -t dex-telegram .
after_success:
- |
  # Create Docker image if branch master or develop and not on pull requests
  if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
    docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";

    PACKAGE_VERSION=$(node -p -e "require('./package.json').version");
    echo "Pushing to Docker-hub version $PACKAGE_VERSION, generated from branch $TRAVIS_BRANCH";

    if [[ $PACKAGE_VERSION = *"-SNAPSHOT"* ]]; then
      echo "Pushing image release...";
      docker tag dex-telegram gnosispm/dex-telegram:release;
      docker push gnosispm/dex-telegram:release;
    elif [ "$TRAVIS_BRANCH" == "master" ]; then
      echo "Pushing image staging...";
      docker tag dex-telegram gnosispm/dex-telegram:staging;
      docker push gnosispm/dex-telegram:staging;
    elif [ "$TRAVIS_BRANCH" == "develop" ]; then
      echo "Pushing image develop...";
      docker tag dex-telegram gnosispm/dex-telegram:develop;
      docker push gnosispm/dex-telegram:develop;
    elif [[ $TRAVIS_TAG = $TRAVIS_BRANCH ]]; then
      echo "Pushing image tag $TRAVIS_TAG...";
      docker tag dex-telegram gnosispm/dex-telegram:$TRAVIS_TAG;
      docker push gnosispm/dex-telegram:$TRAVIS_TAG;
    fi
    echo "The image has been pushed";
  else
    echo "There's no need to push the image to Docker-hub";
  fi
